---
title: "Applied Statistics Coursework 2025/2026"
subtitle: 'MSc in Statistics 2025/26, Imperial College London'
author: "06051710"
format:
  html:
    toc: true
    highlight: tango
    self-contained: true
    df-print: paged
  pdf: default
format-links: false
editor: 
  markdown: 
    wrap: 72
---

```{=html}
<style type="text/css">
h1{
  font-size: 24pt;
}
h2{
  font-size: 18pt;
}
body{
  font-size: 12pt;
}
</style>
```

```{r setup, include = FALSE, tidy=TRUE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
include_solutions <- TRUE
```

```{r setup2, include=FALSE, tidy=TRUE}
set.seed(17)
require(rmarkdown)
require(knitr)
require(kableExtra)
require("mcmc")
require("ggplot2")
# Put any library imports and other preamble here.
```


# Question 1

One way the independence assumption could be violated is if the survey
participants are in frequent contact with one another. This could mean
that even if one participant does not smoke, they may be breathing in
smoke from the smokers around them, making the number of cigarettes
smoked by others directly affect their rate of lung cancer as well.

Another way the independence assumption could be violated is if the
survey participants are related to one another in some way (at its
worst there could be direct relatives in the sample). This would mean due to shared
genetic characteristics, the probability one participant develops cancer
is not independent of the probability another does.

Finally, the independence assumption could be violated by repeated
sampling. For example, sometimes when filling a form online, a glitch could occur and record one participant's responses twice. These two
rows are therefore clearly not independent, as knowing the outcome of the first response perfectly predicts the outcome of the second.

# Question 2

### A

Yes, it would be a loss of information, since we now have no way to
differentiate between somebody who smokes 10 cigarettes a day versus 1
cigarette a day.

### B

The first likelihood can be calculated as follows: (assuming $S_i = 1$
or $0$ depending on whether respondent i is a smoker or not
respectively)

$$
\begin{aligned}
\mathbb{P}(C_{1:N} | p, q, S_{1:N}) &= \prod_{i=1}^n \mathbb{P}(C_i | p, q, S_i) \quad \text{(by assuming independence)} \\
&= \prod_{i=1}^n p^{S_i C_i} \cdot (1-p)^{S_i (1-C_i)} q^{(1-S_i) C_i} (1-q)^{(1-S_i)(1-C_i)} \\
&= p^{\sum_{i=1}^n S_i C_i} \cdot (1-p)^{\sum_{i=1}^n S_i (1-C_i)} q^{\sum_{i=1}^n (1-S_i) C_i} \cdot (1-q)^{\sum_{i=1}^n (1-S_i)(1-C_i)} \\
&= p^{N_{S,C}} (1-p)^{N_S - N_{S,C}} q^{N_{\neg S, C}} (1-q)^{N_{\neg S} - N_{\neg S, C}}
\end{aligned}
$$

With the summary statistics the likelihood is:

$$
\mathbb{P}(N_{S,C}, N_{\neg S, C} \mid p, q, N_S, N_{\neg S}) = \mathbb{P}(N_{S,C} \mid p, N_S) \cdot \mathbb{P}(N_{\neg S, C} \mid q, N_{\neg S})
$$

Which separates due to the assumption of independence in the trials, so
the number of non smokers with cancer should not affect the number of
smokers with cancer in the sample.

Further, the independence between each participant can let us treat the
distribution as the product of two binomial distributions, leading to
the following:

$$
\mathbb{P}(N_{S,C}, N_{\neg S, C} \mid p, q, N_S, N_{\neg S}) = \binom{N_S}{N_{S,C}} p^{N_{S,C}} (1-p)^{N_S - N_{S,C}} \cdot \binom{N_{\neg S}}{N_{\neg S, C}} q^{N_{\neg S, C}} (1-q)^{N_{\neg S} - N_{\neg S, C}}
$$

If we then find the ratio of the two likelihoods, we find it is
independent of both $p$ and $q$, so (by 6.4.1 in the notes) the
statistic $(N_{S,C}, N_{\neg S, C})$ is a sufficient
statistic (so together $N_{S,C}$ and $N_{\neg S, C}$ are jointly
sufficient statistics).

### C

@fig-1 clearly demonstrates how the posterior probability of a smoker
developing lung cancer is higher than the posterior probability of a non
smoker (I sampled from the joint distribution of p and q using Markov Chain Monte
Carlo techniques). Testing the hypothesis that p>q is essentially done in Section D where the competing hypotheses are represented by different models, however, just visually @fig-1 suggests there is high evidence that smoking is linked to lung cancer.

```{r}
#| echo: false
#| label: fig-1
#| fig-cap: "Marginal posterior densities for p and q"

########
#Question 2C
########

library("mcmc")
smoking_dat <- read.csv('smoking.csv')

#Extracting relevant summary statistics

#Number of smokers
Ns <- sum(smoking_dat$cigarettes>0)
#Number of non-smokers
Nns <- 36-Ns 
#Number of smokers with cancer
Nsc <- sum(smoking_dat$cigarettes>0 & smoking_dat$cancer) 
#Number of non smokers with cancer
Nnsc <- sum(smoking_dat$cigarettes==0 & smoking_dat$cancer) 


#will work with log posterior as that is a requirement of metrop (in mcmc library)
log_posterior <- function(theta){
  p<-theta[1]
  q<-theta[2]
  
  #The Uniform Prior on  parameters p and q.
  if (p <= 0 || p >= 1 || q <= 0 || q >= 1) return(-Inf)
  
  #The log of the posterior distribution up to normalisation constant
  log_post <- Nsc*log(p) + (Ns-Nsc)*log(1-p) + Nnsc*log(q) + (Nns - Nnsc)*log(1-q)
  return (log_post)
}

nsmp <- 100000
#started here to demonstrate ignorance of the true distribution
params_initial <- c(0.5,0.5) 

posterior <- metrop(
  obj= log_posterior,
  initial = params_initial,
  nbatch=nsmp
)

posterior_samples <- as.matrix(posterior$batch)
colnames(posterior_samples) <- c("p", "q")

#Plotting the marginal posterior densities for p and q

library(ggplot2)

df <- data.frame(
  value = c(posterior_samples[, "p"], posterior_samples[, "q"]),
  parameter = rep(c("p", "q"), each = nrow(posterior_samples))
)

ggplot(df, aes(x = value, color = parameter)) +
  geom_density(linewidth = 1) +
  labs(
    x = "Value",
    y = "Density"
  ) +
  theme_minimal()




```

### D





# Code Appendix {#sec-code-appendix}

```{r ref.label=knitr::all_labels()}
#| echo: true
#| eval: false
#| code-fold: true

```


